let stationNamesCCW = [
  {
    "駅名": "東京",
    "よみがな": "とうきょう",
    "意味": "日本の首都を表す"
  },
  {
    "駅名": "有楽町",
    "よみがな": "ゆうらくちょう",
    "意味": "「有楽」は徳川家康の弟・有楽斎に由来"
  },
  {
    "駅名": "新橋",
    "よみがな": "しんばし",
    "意味": "「新しい橋」という意味"
  },
  {
    "駅名": "浜松町",
    "よみがな": "はままつちょう",
    "意味": "海沿いの「浜」と「松」のある町"
  },
  {
    "駅名": "田町",
    "よみがな": "たまち",
    "意味": "昔の田んぼが広がる地域の名残"
  },
  {
    "駅名": "品川",
    "よみがな": "しながわ",
    "意味": "「品川」は河川の名前が由来"
  },
  {
    "駅名": "大崎",
    "よみがな": "おおさき",
    "意味": "「崎」は岬を意味する"
  },
  {
    "駅名": "五反田",
    "よみがな": "ごたんだ",
    "意味": "「五反の田んぼ」が由来"
  },
  {
    "駅名": "目黒",
    "よみがな": "めぐろ",
    "意味": "目黒川の名前が由来"
  },
  {
    "駅名": "恵比寿",
    "よみがな": "えびす",
    "意味": "ビールブランド「ヱビス」に由来"
  },
  {
    "駅名": "渋谷",
    "よみがな": "しぶや",
    "意味": "「渋い谷」が語源"
  },
  {
    "駅名": "原宿",
    "よみがな": "はらじゅく",
    "意味": "「原っぱの宿場町」"
  },
  {
    "駅名": "代々木",
    "よみがな": "よよぎ",
    "意味": "「代々続く木々」に由来"
  },
  {
    "駅名": "新宿",
    "よみがな": "しんじゅく",
    "意味": "「新しい宿場町」"
  },
  {
    "駅名": "新大久保",
    "よみがな": "しんおおくぼ",
    "意味": "「大きな窪地」に新しく作られた町"
  },
  {
    "駅名": "高田馬場",
    "よみがな": "たかだのばば",
    "意味": "「高田氏の馬場」に由来"
  },
  {
    "駅名": "目白",
    "よみがな": "めじろ",
    "意味": "「白い馬（目白馬）」が由来"
  },
  {
    "駅名": "池袋",
    "よみがな": "いけぶくろ",
    "意味": "「池が多い場所」"
  },
  {
    "駅名": "大塚",
    "よみがな": "おおつか",
    "意味": "「大きな塚（丘）」が由来"
  },
  {
    "駅名": "巣鴨",
    "よみがな": "すがも",
    "意味": "「鴨が住む巣」に由来"
  },
  {
    "駅名": "駒込",
    "よみがな": "こまごめ",
    "意味": "「駒（馬）が込む」地名"
  },
  {
    "駅名": "田端",
    "よみがな": "たばた",
    "意味": "「田んぼの端（はた）」"
  },
  {
    "駅名": "西日暮里",
    "よみがな": "にしにっぽり",
    "意味": "「日暮らしの里」の西"
  },
  {
    "駅名": "日暮里",
    "よみがな": "にっぽり",
    "意味": "「日が暮れるまで過ごす里」"
  },
  {
    "駅名": "鶯谷",
    "よみがな": "うぐいすだに",
    "意味": "「鶯（うぐいす）が多い谷」"
  },
  {
    "駅名": "上野",
    "よみがな": "うえの",
    "意味": "「上の方にある土地」"
  },
  {
    "駅名": "御徒町",
    "よみがな": "おかちまち",
    "意味": "「御徒（武士の歩兵）の町」"
  },
  {
    "駅名": "秋葉原",
    "よみがな": "あきはばら",
    "意味": "「秋葉神社」が由来"
  },
]

let stationNames = [
  {
    "駅名": "東京",
    "よみがな": "とうきょう",
    "意味": "日本の首都を表す"
  },
  {
    "駅名": "神田",
    "よみがな": "かんだ",
    "意味": "「神田」がかんだ"
  },
  {
    "駅名": "秋葉原",
    "よみがな": "あきはばら",
    "意味": "「秋葉神社」が由来"
  },

  {
    "駅名": "御徒町",
    "よみがな": "おかちまち",
    "意味": "「御徒（武士の歩兵）の町」"
  },
  {
    "駅名": "上野",
    "よみがな": "うえの",
    "意味": "「上の方にある土地」"
  },
  {
    "駅名": "鶯谷",
    "よみがな": "うぐいすだに",
    "意味": "「鶯（うぐいす）が多い谷」"
  },
  {
    "駅名": "日暮里",
    "よみがな": "にっぽり",
    "意味": "「日が暮れるまで過ごす里」"
  },
  {
    "駅名": "西日暮里",
    "よみがな": "にしにっぽり",
    "意味": "「日暮らしの里」の西"
  },
  {
    "駅名": "田端",
    "よみがな": "たばた",
    "意味": "「田んぼの端（はた）」"
  },
  {
    "駅名": "駒込",
    "よみがな": "こまごめ",
    "意味": "「駒（馬）が込む」地名"
  },
  {
    "駅名": "巣鴨",
    "よみがな": "すがも",
    "意味": "「鴨が住む巣」に由来"
  },
  {
    "駅名": "大塚",
    "よみがな": "おおつか",
    "意味": "「大きな塚（丘）」が由来"
  },
  {
    "駅名": "池袋",
    "よみがな": "いけぶくろ",
    "意味": "「池が多い場所」"
  },
  {
    "駅名": "目白",
    "よみがな": "めじろ",
    "意味": "「白い馬（目白馬）」が由来"
  },
    {
    "駅名": "高田馬場",
    "よみがな": "たかだのばば",
    "意味": "「高田氏の馬場」に由来"
  },
  {
    "駅名": "新大久保",
    "よみがな": "しんおおくぼ",
    "意味": "「大きな窪地」に新しく作られた町"
  },
  {
    "駅名": "新宿",
    "よみがな": "しんじゅく",
    "意味": "「新しい宿場町」"
  },
  {
    "駅名": "代々木",
    "よみがな": "よよぎ",
    "意味": "「代々続く木々」に由来"
  },
  {
    "駅名": "原宿",
    "よみがな": "はらじゅく",
    "意味": "「原っぱの宿場町」"
  },
  {
    "駅名": "渋谷",
    "よみがな": "しぶや",
    "意味": "「渋い谷」が語源"
  },
  {
    "駅名": "恵比寿",
    "よみがな": "えびす",
    "意味": "ビールブランド「ヱビス」に由来"
  },
  {
    "駅名": "目黒",
    "よみがな": "めぐろ",
    "意味": "目黒川の名前が由来"
  },
  {
    "駅名": "五反田",
    "よみがな": "ごたんだ",
    "意味": "「五反の田んぼ」が由来"
  },
  {
    "駅名": "大崎",
    "よみがな": "おおさき",
    "意味": "「崎」は岬を意味する"
  },
  {
    "駅名": "品川",
    "よみがな": "しながわ",
    "意味": "「品川」は河川の名前が由来"
  },
  {
    "駅名": "田町",
    "よみがな": "たまち",
    "意味": "昔の田んぼが広がる地域の名残"
  },
  {
    "駅名": "浜松町",
    "よみがな": "はままつちょう",
    "意味": "海沿いの「浜」と「松」のある町"
  },
  {
    "駅名": "新橋",
    "よみがな": "しんばし",
    "意味": "「新しい橋」という意味"
  },
  {
    "駅名": "有楽町",
    "よみがな": "ゆうらくちょう",
    "意味": "「有楽」は徳川家康の弟・有楽斎に由来"
  }
]

const svg = document.querySelector('.yamanote-line');
const fuse = svg.querySelector('.fuse');
const stations = document.querySelector('.yamanote-stations');
const title = document.querySelector('.station-title');
const rollBtn = document.getElementsByClassName('train-btn')[0];
const sound = document.querySelector('.sound');
const colors = ['#7FC342', '#a6c888', '#5a6550', '#4b8516', '#7fff0a'];

let ran = randomIntFromRange(0, stationNames.length);

function randomIntFromRange(min, max) {
  return Math.floor(Math.random() * (max - min * 1) + min);
}

let len = stations.children.length - 1;

function resetActive(target) {
  const active = document.getElementsByClassName('selected-station')[0];
  if (active) {
    active.classList.remove('selected-station');
  }
  
  target.classList.add('selected-station');
}

for (let c = 0; c <= len; c++) {
  // stationNames[c]['dist'] = stations.children[0].getTotalLength() * c;
  stations.children[c].addEventListener('click', (event) => {
    const name = stationNames[c]['駅名'];
    console.log(c, name);
    title.textContent = name;
    resetActive(event.target);
  })
}

function playAudio(time) {
  sound.currentTime = time;
  sound.play();
  setTimeout(() => { sound.pause(); }, 1000)
}

function startTween() {
  ran = randomIntFromRange(0, stationNames.length);

  let dist = stations.children[0].getTotalLength() * ran;
  let n = 0;

  const finished = {
    distance: 0
  }

  let start = {
    distance: dist,
    repeat: 0,
    repeatDelay: 1,
    duration: 3,
    onUpdate: () => {
      const point = fuse.getPointAtLength(finished.distance);
      createParticle(point);
    }
  }

  gsap.to(finished, start);
}

function createParticle(point) {
  // Create a new circle element
  const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
  // Prepend the element to the SVG
  svg.prepend(circle);
  // // Set the coordinates of that circle
  circle.setAttribute('cx', point.x);
  circle.setAttribute('cy', point.y);
  // // Define a random radius for each circle
  circle.setAttribute('r', (Math.random() * 20) + 0.2);
  // // Define a random color
  circle.setAttribute('fill', gsap.utils.random(colors));
  
  // Animate the circle
  gsap.to(circle, {
    // Random cx based on its current position
    cx: '+=random(-20,20)',
    // Random cy based on its current position
    cy: '+=random(-20,20)',
    // Fade out
    opacity: 0,
    // Random duration for each circle
    duration: 'random(1, 3)',
    // Prevent gsap from rounding the cx & cy values
    autoRound: false,
    // Once the animation is complete
    onComplete: () => {
      // Remove the SVG element from its parent
      svg.removeChild(circle);
    }
  });
}

/* Animate the fuse to reduce it */
fuse.setAttribute('stroke-dasharray', fuse.getTotalLength());
fuse.setAttribute('stroke-dashoffset', fuse.getTotalLength() * 2);

function toFuse() {
  gsap.to(fuse, {
    strokeDashoffset: fuse.getTotalLength(),
    duration: 3,
    repeat: 0,
  });
}


function toStation() {
  gsap.to(stations.children[ran], {
    strokeDashoffset: fuse.getTotalLength(),
    duration: 3,
    repeat: 0,
    onComplete: () => {
      console.log(stations.children[ran]);
      console.log(stationNames[stations.children.length - ran]['駅名'])
      resetActive(stations.children[ran]);
      title.textContent = stationNames[ran]['駅名'];
    }
  });
}

rollBtn.addEventListener('click', (event) => {
  startTween();
  toStation();
});

window.addEventListener('keydown', (event) => {
  if (event.key == 't') {
    startTween();
    toFuse();
  }
})